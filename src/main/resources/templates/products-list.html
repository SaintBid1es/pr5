<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã ‚Äî –∫–∞—Ç–∞–ª–æ–≥</title>
  <style>
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --danger: #dc3545;
      --success: #28a745;
      --warning: #ffa500;
      --bg-light: #f9f9f9;
      --card-bg: #fff;
      --text-dark: #333;
      --border-light: #e9ecef;
      --shadow: 0 2px 10px rgba(0,0,0,0.08);
      --radius: 10px;
    }

    body {
      background: var(--bg-light);
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 40px 0;
      color: var(--text-dark);
    }

    .container {
      max-width: 1200px;
      margin: auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    h1 {
        color: var(--primary);
        font-size: 2rem;
        margin-top: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .actions {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .button {
      background: var(--primary);
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s ease;
    }
    .button:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    .danger { background: var(--danger); }
    .danger:hover { background: #a8232f; }

    .success { background: var(--success); }
    .success:hover { background: #207435; }

    .warning { background: var(--warning); }
    .warning:hover { background: #e59400; }

    form.filter-form {
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: flex-end;
      flex-wrap: wrap;
      padding: 20px;
      background: #f8f9fa;
      border-radius: var(--radius);
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    input[type="text"], select {
      padding: 10px 12px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 1rem;
      min-width: 200px;
      background: white;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    button[type="submit"] {
      background: var(--primary);
      border: none;
      color: #fff;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button[type="submit"]:hover { background: var(--primary-dark); }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-size: 1rem;
      margin-top: 12px;
      overflow: hidden;
    }

    thead th {
      background: #eef2fa;
      color: var(--text-dark);
      padding: 15px 12px;
      border-bottom: 2px solid var(--border-light);
      font-weight: 700;
      text-align: left;
    }

    thead th a {
        color: inherit;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    thead th a:hover {
        color: var(--primary);
    }

    tbody td {
      border-bottom: 1px solid var(--border-light);
      padding: 12px 10px;
    }

    tr.deleted {
      background: #fff5f5;
      color: #666;
    }
    tr.deleted td {
        text-decoration: line-through;
        opacity: 0.7;
    }

    .actions-col {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
    }

    .actions-col form,
    .actions-col a {
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .actions-col form {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 5px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .tag {
        display: inline-block;
        background: #e4ecfa;
        color: var(--primary-dark);
        padding: 4px 8px;
        border-radius: 12px;
        margin: 2px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .category-badge {
        background: #e8f5e8;
        color: var(--success);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .price {
        font-weight: 700;
        color: var(--success);
    }

    .description {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .pagination {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .pagination-info {
        color: #666;
        font-weight: 500;
    }

    .pagination-links {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .pagination a {
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      color: var(--primary-dark);
      background: var(--card-bg);
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .pagination a:hover,
    .pagination a.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    .stats {
        background: #e8f4fd;
        padding: 15px 20px;
        border-radius: var(--radius);
        margin-bottom: 20px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
    }

    .stat-label {
        font-size: 0.9rem;
        color: #666;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>
    –ö–∞—Ç–∞–ª–æ–≥ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
  </h1>

  <div class="stats" th:if="${productPage}">
    <div class="stat-item">
      <span class="stat-value" th:text="${productPage.totalElements}">0</span>
      <span class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" th:text="${productPage.number + 1}">1</span>
      <span class="stat-label">–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" th:text="${productPage.totalPages}">1</span>
      <span class="stat-label">–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü</span>
    </div>
  </div>

  <div class="actions">
    <a th:href="@{${#authorization.expression('hasRole(''ROLE_ADMIN'')') ? '/' : '/manager/dashboard'}}" class="button">
      <i>‚Üê</i>
      <span th:text="${#authorization.expression('hasRole(''ROLE_ADMIN'')') ? '–í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' : '–í –ø–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞'}"></span>
    </a>
    <a href="/products/new" class="button success">
      <i>+</i> –î–æ–±–∞–≤–∏—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π —Ç–æ–≤–∞—Ä
    </a>
  </div>

  <form class="filter-form" method="get" action="/products/list">
    <div class="form-group">
      <label for="search">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é:</label>
      <input type="text" id="search" name="search" th:value="${search}"
             placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–º—è—á, –∫—Ä–æ—Å—Å–æ–≤–∫–∏)...">
    </div>

    <div class="form-group">
      <label for="categoryId">–í–∏–¥ —Å–ø–æ—Ä—Ç–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
      <select id="categoryId" name="categoryId">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option th:each="cat : ${categories}"
                th:value="${cat.id}"
                th:text="${cat.name}"
                th:selected="${categoryId == cat.id}"></option>
      </select>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="showDeleted" name="showDeleted" th:checked="${showDeleted}">
      <label for="showDeleted">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ</label>
    </div>

    <button type="submit">
      –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </button>

    <a th:href="@{/products/list}" class="button" style="background: #6c757d;">
      –°–±—Ä–æ—Å–∏—Ç—å
    </a>
  </form>

  <table>
    <thead>
    <tr>
      <th>
        <a th:href="@{/products/list(sort='id', dir=${sort=='id' && dir=='asc' ? 'desc' : 'asc'}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}">
          ID <i th:text="${sort=='id' ? (dir=='asc' ? '‚Üë' : '‚Üì') : ''}"></i>
        </a>
      </th>
      <th>
        <a th:href="@{/products/list(sort='name', dir=${sort=='name' && dir=='asc' ? 'desc' : 'asc'}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}">
          –ù–∞–∑–≤–∞–Ω–∏–µ <i th:text="${sort=='name' ? (dir=='asc' ? '‚Üë' : '‚Üì') : ''}"></i>
        </a>
      </th>
      <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
      <th>
        <a th:href="@{/products/list(sort='price', dir=${sort=='price' && dir=='asc' ? 'desc' : 'asc'}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}">
          –¶–µ–Ω–∞ <i th:text="${sort=='price' ? (dir=='asc' ? '‚Üë' : '‚Üì') : ''}"></i>
        </a>
      </th>
      <th>–í–∏–¥ —Å–ø–æ—Ä—Ç–∞</th>
      <th>–¢–µ–≥–∏ (—ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞)</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="product : ${productPage.content}" th:classappend="${product.deleted} ? 'deleted' : ''">
      <td th:text="${product.id}"></td>
      <td th:text="${product.name}"></td>
      <td class="description" th:text="${product.description}"></td>
      <td class="price" th:text="${'‚ÇΩ' + product.price}"></td>
      <td>
        <span th:if="${product.category}" class="category-badge" th:text="${product.category.name}"></span>
        <span th:unless="${product.category}" style="color: #999;">‚Äî</span>
      </td>
      <td>
        <span th:each="tag : ${product.tags}" class="tag" th:text="${tag.name}"></span>
        <span th:if="${product.tags.empty}" style="color: #999;">‚Äî</span>
      </td>
      <td class="actions-col">
        <a th:href="@{/products/edit/{id}(id=${product.id})}" class="button warning"
           th:if="${!product.deleted}">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>

        <form th:action="@{/products/delete}" method="post">
          <input type="hidden" name="id" th:value="${product.id}" />
          <div class="checkbox-group" th:if="${!product.deleted}">
            <input type="checkbox" id="soft_${product.id}" name="soft" checked>
            <label for="soft_${product.id}">–õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ</label>
          </div>
          <button class="button danger" type="submit" th:text="${product.deleted ? '–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞' : '–£–¥–∞–ª–∏—Ç—å'}">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </form>

        <form th:if="${product.deleted}" th:action="@{/products/restore}" method="post">
          <input type="hidden" name="id" th:value="${product.id}" />
          <button class="button success" type="submit">
            <i>‚Ü∂</i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
          </button>
        </form>
      </td>
    </tr>

    <tr th:if="${productPage.content.empty}">
      <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
        <i>üèÄ</i> –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
      </td>
    </tr>
    </tbody>
  </table>

  <div class="pagination">
    <div class="pagination-info">
      –ü–æ–∫–∞–∑–∞–Ω–æ <span th:text="${productPage.numberOfElements}">0</span> –∏–∑
      <span th:text="${productPage.totalElements}">0</span> —Ç–æ–≤–∞—Ä–æ–≤
    </div>

    <div class="pagination-links">
      <a th:if="${productPage.hasPrevious()}"
         th:href="@{/products/list(page=0, size=${size}, sort=${sort}, dir=${dir}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}"
         class="button">
        <i>‚ü™</i> –ü–µ—Ä–≤–∞—è
      </a>

      <a th:if="${productPage.hasPrevious()}"
         th:href="@{/products/list(page=${productPage.number - 1}, size=${size}, sort=${sort}, dir=${dir}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}"
         class="button">
        <i>‚Üê</i> –ù–∞–∑–∞–¥
      </a>

      <span th:each="page : ${#numbers.sequence(0, productPage.totalPages - 1)}"
            th:if="${page >= productPage.number - 2 && page <= productPage.number + 2}">
                <a th:href="@{/products/list(page=${page}, size=${size}, sort=${sort}, dir=${dir}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}"
                   th:classappend="${page == productPage.number} ? 'active' : ''"
                   th:text="${page + 1}">1</a>
            </span>

      <a th:if="${productPage.hasNext()}"
         th:href="@{/products/list(page=${productPage.number + 1}, size=${size}, sort=${sort}, dir=${dir}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}"
         class="button">
        –í–ø–µ—Ä–µ–¥ <i>‚Üí</i>
      </a>

      <a th:if="${productPage.hasNext()}"
         th:href="@{/products/list(page=${productPage.totalPages - 1}, size=${size}, sort=${sort}, dir=${dir}, search=${search}, categoryId=${categoryId}, showDeleted=${showDeleted})}"
         class="button">
        –ü–æ—Å–ª–µ–¥–Ω—è—è <i>‚ü´</i>
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      const deleteForms = document.querySelectorAll('form[action*="delete"]');
      deleteForms.forEach(form => {
          form.addEventListener('submit', function(e) {
              const isSoftDelete = this.querySelector('input[name="soft"]')?.checked;
              const message = isSoftDelete ?
                  '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç?' :
                  '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –Ω–∞–≤—Å–µ–≥–¥–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';

              if (!confirm(message)) {
                  e.preventDefault();
              }
          });
      });
  });
</script>
</body>
</html>